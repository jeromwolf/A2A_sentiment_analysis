<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A2A Ìà¨Ïûê Î∂ÑÏÑù ÏãúÏä§ÌÖú V2 - PDF Export</title>
    <style>
        /* Í∏∞Ï°¥ Ïä§ÌÉÄÏùº Ïú†ÏßÄ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
        }
        
        .input-section {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        
        .input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        input[type="text"] {
            flex: 1;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        input[type="text"]:focus {
            outline: none;
            border-color: #3498db;
        }
        
        button {
            background: #3498db;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        button:hover {
            background: #2980b9;
        }
        
        button:disabled {
            background: #95a5a6;
            cursor: not-allowed;
        }
        
        .pdf-option {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .pdf-option label {
            font-size: 14px;
            color: #666;
        }
        
        .agents-flow {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        
        .agent-nodes {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .agent-node {
            background: #ecf0f1;
            padding: 15px 20px;
            border-radius: 5px;
            text-align: center;
            position: relative;
            transition: all 0.3s;
            flex: 1;
            min-width: 150px;
        }
        
        .agent-node.active {
            background: #3498db;
            color: white;
        }
        
        .agent-node.completed {
            background: #27ae60;
            color: white;
        }
        
        .logs {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            max-height: 400px;
            overflow-y: auto;
            margin-bottom: 30px;
        }
        
        .log-entry {
            padding: 10px;
            border-bottom: 1px solid #eee;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }
        
        .log-entry:last-child {
            border-bottom: none;
        }
        
        .results {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .score-display {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .score-value {
            font-size: 48px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .score-positive { color: #27ae60; }
        .score-negative { color: #e74c3c; }
        .score-neutral { color: #f39c12; }
        
        .report-content {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 5px;
            margin-top: 20px;
        }
        
        .pdf-download {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 20px;
            padding: 15px;
            background: #e8f5e9;
            border-radius: 5px;
        }
        
        .pdf-download button {
            background: #27ae60;
        }
        
        .pdf-download button:hover {
            background: #229954;
        }
        
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ü§ñ A2A Ìà¨Ïûê Î∂ÑÏÑù ÏãúÏä§ÌÖú V2</h1>
        
        <div class="input-section">
            <h2>Ìà¨Ïûê Î∂ÑÏÑù ÏöîÏ≤≠</h2>
            <div class="pdf-option">
                <input type="checkbox" id="generatePdf" checked>
                <label for="generatePdf">üìÑ PDF Î¶¨Ìè¨Ìä∏ ÏÉùÏÑ±</label>
            </div>
            <div class="input-group">
                <input type="text" id="queryInput" placeholder="Ïòà: Ïï†Ìîå Ï£ºÍ∞Ä Ïñ¥Îïå? / TSLA Ìà¨ÏûêÌï¥ÎèÑ Îê†Íπå?" />
                <button id="analyzeBtn" onclick="startAnalysis()">Î∂ÑÏÑù ÏãúÏûë</button>
            </div>
        </div>
        
        <div class="agents-flow">
            <h3>ÏóêÏù¥Ï†ÑÌä∏ Ï≤òÎ¶¨ ÌòÑÌô©</h3>
            <div class="agent-nodes">
                <div class="agent-node" id="nlu-agent">NLU Agent</div>
                <div class="agent-node" id="news-agent">News Agent</div>
                <div class="agent-node" id="twitter-agent">Twitter Agent</div>
                <div class="agent-node" id="sec-agent">SEC Agent</div>
                <div class="agent-node" id="sentiment-agent">Sentiment Agent</div>
                <div class="agent-node" id="score-agent">Score Agent</div>
                <div class="agent-node" id="report-agent">Report Agent</div>
            </div>
        </div>
        
        <div class="logs">
            <h3>Ï≤òÎ¶¨ Î°úÍ∑∏</h3>
            <div id="logContent"></div>
        </div>
        
        <div class="results hidden" id="results">
            <h2>Î∂ÑÏÑù Í≤∞Í≥º</h2>
            <div class="score-display">
                <div class="score-value" id="scoreValue">-</div>
                <div id="scoreLabel">-</div>
            </div>
            
            <div class="pdf-download hidden" id="pdfDownload">
                <span>üìÑ PDF Î¶¨Ìè¨Ìä∏Í∞Ä ÏÉùÏÑ±ÎêòÏóàÏäµÎãàÎã§:</span>
                <span id="pdfPath"></span>
                <button onclick="downloadPdf()">PDF Îã§Ïö¥Î°úÎìú</button>
            </div>
            
            <div id="reportContainer" class="report-content"></div>
        </div>
    </div>
    
    <script>
        let ws = null;
        let currentPdfPath = null;
        
        function connectWebSocket() {
            ws = new WebSocket('ws://localhost:8000/ws');
            
            ws.onopen = () => {
                addLog('‚úÖ ÏÑúÎ≤Ñ Ïó∞Í≤∞Îê®');
            };
            
            ws.onmessage = (event) => {
                const data = JSON.parse(event.data);
                handleMessage(data);
            };
            
            ws.onclose = () => {
                addLog('‚ùå ÏÑúÎ≤Ñ Ïó∞Í≤∞ ÎÅäÍπÄ');
                // Ïû¨Ïó∞Í≤∞ ÏãúÎèÑ
                setTimeout(connectWebSocket, 3000);
            };
            
            ws.onerror = (error) => {
                addLog('‚ùå Ïó∞Í≤∞ Ïò§Î•ò: ' + error);
            };
        }
        
        function handleMessage(data) {
            switch(data.type) {
                case 'log':
                    addLog(data.message);
                    break;
                case 'status':
                    updateAgentStatus(data.agentId);
                    break;
                case 'result':
                    displayResults(data);
                    break;
            }
        }
        
        function addLog(message) {
            const logContent = document.getElementById('logContent');
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logContent.appendChild(entry);
            logContent.scrollTop = logContent.scrollHeight;
        }
        
        function updateAgentStatus(agentId) {
            const node = document.getElementById(agentId);
            if (node) {
                // Î™®Îì† ÏóêÏù¥Ï†ÑÌä∏Ïùò active ÏÉÅÌÉú Ï†úÍ±∞
                document.querySelectorAll('.agent-node').forEach(n => {
                    if (n.classList.contains('active') && n.id !== agentId) {
                        n.classList.remove('active');
                        n.classList.add('completed');
                    }
                });
                node.classList.add('active');
            }
        }
        
        function displayResults(data) {
            const resultsDiv = document.getElementById('results');
            const scoreValue = document.getElementById('scoreValue');
            const scoreLabel = document.getElementById('scoreLabel');
            const reportContainer = document.getElementById('reportContainer');
            
            // Ï†êÏàò ÌëúÏãú
            const score = data.final_score || 0;
            scoreValue.textContent = score.toFixed(2);
            
            // Ï†êÏàòÏóê Îî∞Î•∏ ÏÉâÏÉÅ Î∞è ÎùºÎ≤®
            if (score > 0.3) {
                scoreValue.className = 'score-value score-positive';
                scoreLabel.textContent = 'Í∏çÏ†ïÏ†Å (Positive)';
            } else if (score < -0.3) {
                scoreValue.className = 'score-value score-negative';
                scoreLabel.textContent = 'Î∂ÄÏ†ïÏ†Å (Negative)';
            } else {
                scoreValue.className = 'score-value score-neutral';
                scoreLabel.textContent = 'Ï§ëÎ¶ΩÏ†Å (Neutral)';
            }
            
            // Î¶¨Ìè¨Ìä∏ ÌëúÏãú
            if (data.report) {
                reportContainer.innerHTML = data.report;
            }
            
            // PDF Îã§Ïö¥Î°úÎìú ÏÑπÏÖò ÌëúÏãú
            if (data.pdf_path) {
                currentPdfPath = data.pdf_path;
                document.getElementById('pdfPath').textContent = data.pdf_path.split('/').pop();
                document.getElementById('pdfDownload').classList.remove('hidden');
            }
            
            resultsDiv.classList.remove('hidden');
            
            // Î™®Îì† ÏóêÏù¥Ï†ÑÌä∏ ÏôÑÎ£å ÌëúÏãú
            document.querySelectorAll('.agent-node.active').forEach(n => {
                n.classList.remove('active');
                n.classList.add('completed');
            });
        }
        
        async function startAnalysis() {
            const query = document.getElementById('queryInput').value.trim();
            if (!query) {
                alert('Î∂ÑÏÑùÌï† ÎÇ¥Ïö©ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }
            
            // UI Ï¥àÍ∏∞Ìôî
            document.getElementById('results').classList.add('hidden');
            document.getElementById('pdfDownload').classList.add('hidden');
            document.getElementById('logContent').innerHTML = '';
            document.querySelectorAll('.agent-node').forEach(n => {
                n.classList.remove('active', 'completed');
            });
            
            // Î≤ÑÌäº ÎπÑÌôúÏÑ±Ìôî
            const button = document.getElementById('analyzeBtn');
            button.disabled = true;
            button.textContent = 'Î∂ÑÏÑù Ï§ë...';
            
            // PDF ÏÉùÏÑ± ÏòµÏÖò ÌôïÏù∏
            const generatePdf = document.getElementById('generatePdf').checked;
            
            // Î∂ÑÏÑù ÏöîÏ≤≠ Ï†ÑÏÜ°
            if (ws && ws.readyState === WebSocket.OPEN) {
                ws.send(JSON.stringify({
                    type: 'analyze',
                    query: query,
                    generate_pdf: generatePdf
                }));
            } else {
                alert('ÏÑúÎ≤Ñ Ïó∞Í≤∞Ïù¥ ÎÅäÏñ¥Ï°åÏäµÎãàÎã§. Ïû¨Ïó∞Í≤∞ Ï§ë...');
                connectWebSocket();
            }
            
            // Î≤ÑÌäº Ïû¨ÌôúÏÑ±Ìôî (30Ï¥à ÌõÑ)
            setTimeout(() => {
                button.disabled = false;
                button.textContent = 'Î∂ÑÏÑù ÏãúÏûë';
            }, 30000);
        }
        
        async function downloadPdf() {
            if (!currentPdfPath) {
                alert('PDF ÌååÏùº Í≤ΩÎ°úÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');
                return;
            }
            
            // Ïã§Ï†ú Íµ¨ÌòÑÏóêÏÑúÎäî ÏÑúÎ≤ÑÏóêÏÑú PDF ÌååÏùºÏùÑ Ï†úÍ≥µÌïòÎäî ÏóîÎìúÌè¨Ïù∏Ìä∏ ÌïÑÏöî
            // Ïó¨Í∏∞ÏÑúÎäî Í≤ΩÎ°úÎßå ÌëúÏãú
            alert(`PDF ÌååÏùºÏù¥ Îã§Ïùå Í≤ΩÎ°úÏóê Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§:\n${currentPdfPath}`);
        }
        
        // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú WebSocket Ïó∞Í≤∞
        window.onload = () => {
            connectWebSocket();
        };
        
        // ÏóîÌÑ∞ÌÇ§Î°ú Î∂ÑÏÑù ÏãúÏûë
        document.getElementById('queryInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                startAnalysis();
            }
        });
    </script>
</body>
</html>
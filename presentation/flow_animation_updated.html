<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A2A + MCP ì‹¤ì‹œê°„ í†µì‹  íë¦„ ì• ë‹ˆë©”ì´ì…˜</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #0a0a0a;
            color: white;
            font-family: 'Pretendard', -apple-system, sans-serif;
            overflow: hidden;
        }
        
        #canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        
        .control-panel {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            padding: 20px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            z-index: 100;
            max-width: 300px;
        }
        
        .control-panel h3 {
            margin-top: 0;
            color: #4fc3f7;
            font-size: 18px;
        }
        
        .protocol-status {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .protocol-badge {
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .protocol-badge.a2a {
            background: linear-gradient(45deg, #4fc3f7, #2196f3);
        }
        
        .protocol-badge.mcp {
            background: linear-gradient(45deg, #ff5722, #ff9800);
        }
        
        button {
            background: linear-gradient(135deg, #4fc3f7, #ab5dee);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
            transition: all 0.3s ease;
            width: 100%;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(79, 195, 247, 0.3);
        }
        
        .message-log {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.8);
            padding: 20px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            z-index: 100;
            max-width: 400px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .message-log h3 {
            margin-top: 0;
            color: #ab5dee;
        }
        
        .log-entry {
            padding: 8px;
            margin: 8px 0;
            border-left: 3px solid #4fc3f7;
            padding-left: 15px;
            font-size: 13px;
            opacity: 0;
            animation: fadeIn 0.5s forwards;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.05);
        }
        
        .log-entry.a2a {
            border-left-color: #4fc3f7;
        }
        
        .log-entry.mcp {
            border-left-color: #ff5722;
        }
        
        @keyframes fadeIn {
            to { opacity: 1; }
        }
        
        .stats {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            padding: 20px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            z-index: 100;
        }
        
        .stat-item {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
        }
        
        .stat-value {
            color: #4fc3f7;
            font-weight: bold;
        }
        
        .tooltip {
            position: fixed;
            background: rgba(0, 0, 0, 0.95);
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            border: 1px solid #4fc3f7;
            box-shadow: 0 5px 15px rgba(79, 195, 247, 0.3);
            pointer-events: none;
            z-index: 1000;
            display: none;
            max-width: 300px;
            font-size: 14px;
        }
        
        .tooltip h4 {
            margin: 0 0 10px 0;
            color: #4fc3f7;
            font-size: 16px;
        }
        
        .tooltip p {
            margin: 5px 0;
            line-height: 1.4;
        }
        
        .tooltip .status {
            display: inline-block;
            width: 8px;
            height: 8px;
            background: #4caf50;
            border-radius: 50%;
            margin-right: 5px;
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.2); }
            100% { opacity: 1; transform: scale(1); }
        }
        
        .message-popup {
            position: fixed;
            background: linear-gradient(135deg, rgba(79, 195, 247, 0.95), rgba(171, 93, 238, 0.95));
            color: white;
            padding: 10px 15px;
            border-radius: 20px;
            font-size: 12px;
            pointer-events: none;
            z-index: 999;
            display: none;
            animation: fadeInOut 2s ease-in-out;
        }
        
        @keyframes fadeInOut {
            0% { opacity: 0; transform: translateY(10px); }
            20% { opacity: 1; transform: translateY(0); }
            80% { opacity: 1; transform: translateY(0); }
            100% { opacity: 0; transform: translateY(-10px); }
        }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    
    <div class="control-panel">
        <h3>ğŸ¤– ì—ì´ì „íŠ¸ íˆ¬ì ì‹œëŒ€</h3>
        <div class="protocol-status">
            <span class="protocol-badge a2a">A2A í†µì‹ </span>
            <span class="protocol-badge mcp">MCP í‘œì¤€</span>
        </div>
        <button onclick="simulateInvestmentAnalysis()">ğŸ’° íˆ¬ì ë¶„ì„ ì‹œë®¬ë ˆì´ì…˜</button>
        <button onclick="showA2AFlow()">ğŸ”„ A2A ë©”ì‹œì§€ íë¦„</button>
        <button onclick="showMCPFlow()">ğŸ”Œ MCP í”„ë¡œí† ì½œ ë™ì‘</button>
        <button onclick="toggleAnimation()">â¸ï¸ ì• ë‹ˆë©”ì´ì…˜ ì œì–´</button>
        <button onclick="resetSystem()">ğŸ”„ ì‹œìŠ¤í…œ ë¦¬ì…‹</button>
    </div>
    
    <div class="message-log">
        <h3>ğŸ“¡ ì‹¤ì‹œê°„ í†µì‹  ë¡œê·¸</h3>
        <div id="messageLog"></div>
    </div>
    
    <div class="stats">
        <div class="stat-item">
            <span>ì „ì†¡ ë©”ì‹œì§€:</span>
            <span class="stat-value" id="message-count">0</span>
        </div>
        <div class="stat-item">
            <span>A2A í™œì„±:</span>
            <span class="stat-value" id="a2a-count">10</span>
        </div>
        <div class="stat-item">
            <span>MCP í™œì„±:</span>
            <span class="stat-value" id="mcp-count">2</span>
        </div>
        <div class="stat-item">
            <span>ì²˜ë¦¬ ì‹œê°„:</span>
            <span class="stat-value" id="process-time">0ms</span>
        </div>
    </div>
    
    <div class="tooltip" id="tooltip"></div>
    <div class="message-popup" id="messagePopup"></div>
    
    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        
        // í˜„ì¬ êµ¬í˜„ ìƒíƒœë¥¼ ë°˜ì˜í•œ ì—ì´ì „íŠ¸ ì •ì˜
        const agents = [
            { 
                id: 'orchestrator', 
                name: 'Main Orchestrator', 
                x: 0, y: 0, 
                color: '#4fc3f7', 
                type: 'control',
                port: '8100',
                protocol: 'A2A',
                status: 'IMPLEMENTED',
                description: 'ì „ì²´ ì›Œí¬í”Œë¡œìš°ë¥¼ ì¡°ìœ¨í•˜ëŠ” ì¤‘ì•™ ê´€ì œíƒ‘',
                detail: 'A2A ë©”ì‹œì§€ë¡œ ëª¨ë“  ì—ì´ì „íŠ¸ì™€ í†µì‹ í•˜ë©° ì‘ì—…ì„ í• ë‹¹í•˜ê³  ê²°ê³¼ë¥¼ ìˆ˜ì§‘í•©ë‹ˆë‹¤.'
            },
            { 
                id: 'registry', 
                name: 'Service Registry', 
                x: 0, y: 0, 
                color: '#2196f3', 
                type: 'control',
                port: '8001',
                protocol: 'A2A',
                status: 'IMPLEMENTED',
                description: 'ì—ì´ì „íŠ¸ ë“±ë¡ ë° ë°œê²¬ ì„œë¹„ìŠ¤',
                detail: 'ëª¨ë“  ì—ì´ì „íŠ¸ì˜ ìœ„ì¹˜ì™€ ëŠ¥ë ¥ì„ ê´€ë¦¬í•˜ê³  ë™ì  ë°œê²¬ì„ ì œê³µí•©ë‹ˆë‹¤.'
            },
            { 
                id: 'mcp-server', 
                name: 'MCP Server', 
                x: 0, y: 0, 
                color: '#ff5722', 
                type: 'control',
                port: '3000',
                protocol: 'MCP',
                status: 'IMPLEMENTED',
                description: 'MCP í‘œì¤€ ì„œë²„ (JSON-RPC 2.0)',
                detail: 'ì• ë„ë¦¬ìŠ¤íŠ¸ ë¦¬í¬íŠ¸, ë‚´ë¶€ì ê±°ë˜ ë“± í”„ë¦¬ë¯¸ì—„ ë°ì´í„° ì œê³µ'
            },
            { 
                id: 'nlu', 
                name: 'NLU Agent', 
                x: 0, y: 0, 
                color: '#66bb6a', 
                type: 'data',
                port: '8108',
                protocol: 'A2A',
                status: 'IMPLEMENTED',
                description: 'ìì—°ì–´ ì´í•´ ì—ì´ì „íŠ¸',
                detail: 'A2A ë©”ì‹œì§€ë¡œ ì‚¬ìš©ì ì…ë ¥ì—ì„œ ì£¼ì‹ í‹°ì»¤ë¥¼ ì¶”ì¶œí•©ë‹ˆë‹¤. (ì˜ˆ: "ì• í”Œ" â†’ "AAPL")'
            },
            { 
                id: 'news', 
                name: 'News Agent', 
                x: 0, y: 0, 
                color: '#ff9800', 
                type: 'data',
                port: '8307',
                protocol: 'A2A',
                status: 'IMPLEMENTED',
                description: 'ë‰´ìŠ¤ ë°ì´í„° ìˆ˜ì§‘',
                detail: 'A2A ë©”ì‹œì§€ë¡œ Finnhub APIë¥¼ í†µí•´ ìµœì‹  ë‰´ìŠ¤ë¥¼ ìˆ˜ì§‘í•˜ê³  ê°ì •ì„ ë¶„ì„í•©ë‹ˆë‹¤.'
            },
            { 
                id: 'twitter', 
                name: 'Twitter Agent', 
                x: 0, y: 0, 
                color: '#00bcd4', 
                type: 'data',
                port: '8209',
                protocol: 'A2A',
                status: 'IMPLEMENTED',
                description: 'ì†Œì…œ ë¯¸ë””ì–´ ë¶„ì„',
                detail: 'A2A ë©”ì‹œì§€ë¡œ Twitter APIë¡œ ì‹¤ì‹œê°„ ì‹œì¥ ê°ì •ì„ íŒŒì•…í•©ë‹ˆë‹¤.'
            },
            { 
                id: 'sec', 
                name: 'SEC Agent', 
                x: 0, y: 0, 
                color: '#9c27b0', 
                type: 'data',
                port: '8210',
                protocol: 'A2A',
                status: 'IMPLEMENTED',
                description: 'SEC ê³µì‹œ ë°ì´í„°',
                detail: 'A2A ë©”ì‹œì§€ë¡œ EDGAR APIë¡œ 10-K, 10-Q, 8-K, Form 4 ë“±ì„ ë¶„ì„í•©ë‹ˆë‹¤.'
            },
            { 
                id: 'dart', 
                name: 'DART Agent', 
                x: 0, y: 0, 
                color: '#3f51b5', 
                type: 'data',
                port: '8213',
                protocol: 'A2A',
                status: 'IMPLEMENTED',
                description: 'í•œêµ­ ê¸°ì—… ê³µì‹œ ë°ì´í„°',
                detail: 'A2A ë©”ì‹œì§€ë¡œ DART APIë¥¼ í†µí•´ í•œêµ­ ê¸°ì—… ê³µì‹œë¥¼ ë¶„ì„í•©ë‹ˆë‹¤.'
            },
            { 
                id: 'mcp-agent', 
                name: 'MCP Data Agent', 
                x: 0, y: 0, 
                color: '#ff5722', 
                type: 'data',
                port: '8215',
                protocol: 'MCP',
                status: 'IMPLEMENTED',
                description: 'MCP í”„ë¦¬ë¯¸ì—„ ë°ì´í„°',
                detail: 'MCP í‘œì¤€ìœ¼ë¡œ ì• ë„ë¦¬ìŠ¤íŠ¸ ë¦¬í¬íŠ¸, ë‚´ë¶€ì ê±°ë˜ ë“± í”„ë¦¬ë¯¸ì—„ ë°ì´í„° ìˆ˜ì§‘'
            },
            { 
                id: 'sentiment', 
                name: 'Sentiment Agent', 
                x: 0, y: 0, 
                color: '#e91e63', 
                type: 'analysis',
                port: '8202',
                protocol: 'A2A',
                status: 'IMPLEMENTED',
                description: 'AI ê°ì • ë¶„ì„',
                detail: 'A2A ë©”ì‹œì§€ë¡œ Gemini AIë¥¼ í™œìš©í•´ í…ìŠ¤íŠ¸ì˜ ê°ì •ì„ ë¶„ì„í•©ë‹ˆë‹¤.'
            },
            { 
                id: 'quantitative', 
                name: 'Quantitative Agent', 
                x: 0, y: 0, 
                color: '#607d8b', 
                type: 'analysis',
                port: '8211',
                protocol: 'A2A',
                status: 'IMPLEMENTED',
                description: 'ì •ëŸ‰ì  ë¶„ì„',
                detail: 'A2A ë©”ì‹œì§€ë¡œ ê¸°ìˆ ì  ì§€í‘œ ë° ì •ëŸ‰ì  ë¶„ì„ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.'
            },
            { 
                id: 'score', 
                name: 'Score Agent', 
                x: 0, y: 0, 
                color: '#ffc107', 
                type: 'analysis',
                port: '8203',
                protocol: 'A2A',
                status: 'IMPLEMENTED',
                description: 'ì ìˆ˜ ê³„ì‚°',
                detail: 'A2A ë©”ì‹œì§€ë¡œ ê°€ì¤‘ì¹˜ ê¸°ë°˜ ì¢…í•© ì ìˆ˜ë¥¼ ê³„ì‚°í•©ë‹ˆë‹¤.'
            },
            { 
                id: 'risk', 
                name: 'Risk Agent', 
                x: 0, y: 0, 
                color: '#f44336', 
                type: 'analysis',
                port: '8212',
                protocol: 'A2A',
                status: 'IMPLEMENTED',
                description: 'ë¦¬ìŠ¤í¬ ë¶„ì„',
                detail: 'A2A ë©”ì‹œì§€ë¡œ ì¢…í•©ì ì¸ ë¦¬ìŠ¤í¬ í‰ê°€ë¥¼ ìˆ˜í–‰í•©ë‹ˆë‹¤.'
            },
            { 
                id: 'report', 
                name: 'Report Agent', 
                x: 0, y: 0, 
                color: '#795548', 
                type: 'output',
                port: '8204',
                protocol: 'A2A',
                status: 'IMPLEMENTED',
                description: 'ë³´ê³ ì„œ ìƒì„±',
                detail: 'A2A ë©”ì‹œì§€ë¡œ ëª¨ë“  ë¶„ì„ ê²°ê³¼ë¥¼ ì¢…í•©í•˜ì—¬ ìµœì¢… íˆ¬ì ë³´ê³ ì„œë¥¼ ìƒì„±í•©ë‹ˆë‹¤.'
            }
        ];
        
        let messages = [];
        let connections = [];
        let isAnimating = true;
        let messageCount = 0;
        
        // ì´ˆê¸°í™”
        function initAgents() {
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const radius = Math.min(canvas.width, canvas.height) * 0.3;
            
            agents.forEach((agent, index) => {
                const angle = (index * 2 * Math.PI) / agents.length;
                agent.x = centerX + Math.cos(angle) * radius;
                agent.y = centerY + Math.sin(angle) * radius;
                agent.pulse = 0;
                agent.connections = [];
            });
        }
        
        // ì—ì´ì „íŠ¸ ê·¸ë¦¬ê¸°
        function drawAgent(agent) {
            const pulse = Math.sin(agent.pulse) * 0.3 + 1;
            const size = 25 * pulse;
            
            // í”„ë¡œí† ì½œë³„ í…Œë‘ë¦¬
            ctx.strokeStyle = agent.protocol === 'MCP' ? '#ff5722' : '#4fc3f7';
            ctx.lineWidth = 3;
            
            // ì—ì´ì „íŠ¸ ì›
            ctx.beginPath();
            ctx.arc(agent.x, agent.y, size, 0, 2 * Math.PI);
            ctx.fillStyle = agent.color;
            ctx.fill();
            ctx.stroke();
            
            // í”„ë¡œí† ì½œ í‘œì‹œ
            ctx.fillStyle = 'white';
            ctx.font = '10px Arial';
            ctx.textAlign = 'center';
            ctx.fillText(agent.protocol, agent.x, agent.y - 35);
            
            // ì´ë¦„ í‘œì‹œ
            ctx.fillStyle = 'white';
            ctx.font = '12px Arial';
            ctx.textAlign = 'center';
            ctx.fillText(agent.name, agent.x, agent.y + 45);
            
            // ìƒíƒœ í‘œì‹œ
            ctx.fillStyle = '#4caf50';
            ctx.font = '8px Arial';
            ctx.fillText(`âœ“ ${agent.status}`, agent.x, agent.y + 60);
            
            agent.pulse += 0.1;
        }
        
        // ë©”ì‹œì§€ ê·¸ë¦¬ê¸°
        function drawMessage(message) {
            const progress = (Date.now() - message.startTime) / message.duration;
            
            if (progress >= 1) {
                message.completed = true;
                return;
            }
            
            const x = message.fromX + (message.toX - message.fromX) * progress;
            const y = message.fromY + (message.toY - message.fromY) * progress;
            
            // ë©”ì‹œì§€ ì 
            ctx.beginPath();
            ctx.arc(x, y, 8, 0, 2 * Math.PI);
            ctx.fillStyle = message.protocol === 'MCP' ? '#ff5722' : '#4fc3f7';
            ctx.fill();
            
            // ë©”ì‹œì§€ í…ìŠ¤íŠ¸
            ctx.fillStyle = 'white';
            ctx.font = '10px Arial';
            ctx.textAlign = 'center';
            ctx.fillText(message.text, x, y - 15);
        }
        
        // ì—°ê²°ì„  ê·¸ë¦¬ê¸°
        function drawConnection(from, to, opacity = 0.3) {
            ctx.strokeStyle = `rgba(79, 195, 247, ${opacity})`;
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(from.x, from.y);
            ctx.lineTo(to.x, to.y);
            ctx.stroke();
        }
        
        // ë©”ì‹œì§€ ì „ì†¡
        function sendMessage(fromId, toId, text, protocol = 'A2A') {
            const from = agents.find(a => a.id === fromId);
            const to = agents.find(a => a.id === toId);
            
            if (from && to) {
                const message = {
                    fromX: from.x,
                    fromY: from.y,
                    toX: to.x,
                    toY: to.y,
                    text: text,
                    protocol: protocol,
                    startTime: Date.now(),
                    duration: 2000,
                    completed: false
                };
                
                messages.push(message);
                messageCount++;
                
                // ë¡œê·¸ ì¶”ê°€
                addLog(`[${protocol}] ${from.name} â†’ ${to.name}: ${text}`, protocol.toLowerCase());
                
                // í†µê³„ ì—…ë°ì´íŠ¸
                document.getElementById('message-count').textContent = messageCount;
            }
        }
        
        // ë¡œê·¸ ì¶”ê°€
        function addLog(message, type = 'a2a') {
            const logDiv = document.getElementById('messageLog');
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            
            logDiv.appendChild(entry);
            logDiv.scrollTop = logDiv.scrollHeight;
            
            // ë¡œê·¸ ê°œìˆ˜ ì œí•œ
            if (logDiv.children.length > 20) {
                logDiv.removeChild(logDiv.firstChild);
            }
        }
        
        // íˆ¬ì ë¶„ì„ ì‹œë®¬ë ˆì´ì…˜
        function simulateInvestmentAnalysis() {
            const startTime = Date.now();
            
            // 1. ì‚¬ìš©ì ì¿¼ë¦¬ â†’ NLU
            setTimeout(() => {
                sendMessage('orchestrator', 'nlu', 'extract_ticker("ì• í”Œ ì£¼ê°€")', 'A2A');
            }, 0);
            
            // 2. NLU â†’ ë°ì´í„° ìˆ˜ì§‘ ì—ì´ì „íŠ¸ë“¤
            setTimeout(() => {
                sendMessage('nlu', 'orchestrator', 'ticker: AAPL', 'A2A');
                sendMessage('orchestrator', 'news', 'collect_data(AAPL)', 'A2A');
                sendMessage('orchestrator', 'twitter', 'collect_data(AAPL)', 'A2A');
                sendMessage('orchestrator', 'sec', 'collect_data(AAPL)', 'A2A');
                sendMessage('orchestrator', 'mcp-agent', 'get_premium_data(AAPL)', 'MCP');
            }, 1000);
            
            // 3. MCP ì„œë²„ í†µì‹ 
            setTimeout(() => {
                sendMessage('mcp-agent', 'mcp-server', 'JSON-RPC: getAnalystReports', 'MCP');
                sendMessage('mcp-server', 'mcp-agent', 'analyst_reports[]', 'MCP');
            }, 2000);
            
            // 4. ë¶„ì„ ì—ì´ì „íŠ¸ë“¤
            setTimeout(() => {
                sendMessage('orchestrator', 'sentiment', 'analyze_sentiment(data)', 'A2A');
                sendMessage('orchestrator', 'quantitative', 'calculate_indicators(AAPL)', 'A2A');
                sendMessage('orchestrator', 'risk', 'assess_risk(AAPL)', 'A2A');
            }, 3000);
            
            // 5. ìµœì¢… ì ìˆ˜ ê³„ì‚° ë° ë³´ê³ ì„œ
            setTimeout(() => {
                sendMessage('orchestrator', 'score', 'calculate_score(results)', 'A2A');
                sendMessage('orchestrator', 'report', 'generate_report(final_data)', 'A2A');
            }, 4000);
            
            // ì²˜ë¦¬ ì‹œê°„ ì—…ë°ì´íŠ¸
            setTimeout(() => {
                const processTime = Date.now() - startTime;
                document.getElementById('process-time').textContent = `${processTime}ms`;
            }, 5000);
        }
        
        // A2A íë¦„ ì‹œê°í™”
        function showA2AFlow() {
            const a2aAgents = agents.filter(a => a.protocol === 'A2A');
            
            a2aAgents.forEach((agent, index) => {
                setTimeout(() => {
                    sendMessage('registry', agent.id, 'register_agent', 'A2A');
                    sendMessage(agent.id, 'registry', 'capabilities', 'A2A');
                }, index * 200);
            });
        }
        
        // MCP íë¦„ ì‹œê°í™”
        function showMCPFlow() {
            setTimeout(() => {
                sendMessage('mcp-agent', 'mcp-server', 'initialize', 'MCP');
                sendMessage('mcp-server', 'mcp-agent', 'capabilities', 'MCP');
                sendMessage('mcp-agent', 'mcp-server', 'tools/list', 'MCP');
                sendMessage('mcp-agent', 'mcp-server', 'tools/call', 'MCP');
            }, 0);
        }
        
        // ì• ë‹ˆë©”ì´ì…˜ ë£¨í”„
        function animate() {
            if (!isAnimating) return;
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // ì—°ê²°ì„  ê·¸ë¦¬ê¸°
            agents.forEach(agent => {
                if (agent.id === 'orchestrator') {
                    agents.forEach(other => {
                        if (other.id !== 'orchestrator') {
                            drawConnection(agent, other, 0.1);
                        }
                    });
                }
            });
            
            // ì—ì´ì „íŠ¸ ê·¸ë¦¬ê¸°
            agents.forEach(drawAgent);
            
            // ë©”ì‹œì§€ ê·¸ë¦¬ê¸°
            messages = messages.filter(message => {
                if (!message.completed) {
                    drawMessage(message);
                    return true;
                }
                return false;
            });
            
            requestAnimationFrame(animate);
        }
        
        // ì• ë‹ˆë©”ì´ì…˜ ì œì–´
        function toggleAnimation() {
            isAnimating = !isAnimating;
            const button = document.querySelector('button[onclick="toggleAnimation()"]');
            button.textContent = isAnimating ? 'â¸ï¸ ì• ë‹ˆë©”ì´ì…˜ ì œì–´' : 'â–¶ï¸ ì• ë‹ˆë©”ì´ì…˜ ì œì–´';
            if (isAnimating) animate();
        }
        
        // ì‹œìŠ¤í…œ ë¦¬ì…‹
        function resetSystem() {
            messages = [];
            messageCount = 0;
            document.getElementById('message-count').textContent = '0';
            document.getElementById('process-time').textContent = '0ms';
            document.getElementById('messageLog').innerHTML = '';
            addLog('ì‹œìŠ¤í…œ ë¦¬ì…‹ ì™„ë£Œ', 'a2a');
        }
        
        // ë§ˆìš°ìŠ¤ ì´ë²¤íŠ¸
        canvas.addEventListener('mousemove', (e) => {
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            const hoveredAgent = agents.find(agent => {
                const dx = x - agent.x;
                const dy = y - agent.y;
                return Math.sqrt(dx * dx + dy * dy) < 30;
            });
            
            const tooltip = document.getElementById('tooltip');
            if (hoveredAgent) {
                tooltip.innerHTML = `
                    <h4>${hoveredAgent.name}</h4>
                    <p><span class="status"></span>${hoveredAgent.status}</p>
                    <p><strong>í¬íŠ¸:</strong> ${hoveredAgent.port}</p>
                    <p><strong>í”„ë¡œí† ì½œ:</strong> ${hoveredAgent.protocol}</p>
                    <p><strong>ì„¤ëª…:</strong> ${hoveredAgent.description}</p>
                    <p>${hoveredAgent.detail}</p>
                `;
                tooltip.style.display = 'block';
                tooltip.style.left = e.clientX + 10 + 'px';
                tooltip.style.top = e.clientY + 10 + 'px';
            } else {
                tooltip.style.display = 'none';
            }
        });
        
        // ì´ˆê¸°í™” ë° ì‹œì‘
        window.addEventListener('resize', () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            initAgents();
        });
        
        initAgents();
        animate();
        
        // ì‹œì‘ ë©”ì‹œì§€
        addLog('A2A + MCP ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì™„ë£Œ', 'a2a');
        addLog('13ê°œ ì»´í¬ë„ŒíŠ¸ í™œì„±í™” (A2A: 11ê°œ, MCP: 2ê°œ)', 'a2a');
        
        // ìë™ ë°ëª¨ (5ì´ˆ í›„)
        setTimeout(() => {
            simulateInvestmentAnalysis();
        }, 3000);
    </script>
</body>
</html>